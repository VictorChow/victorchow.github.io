---
layout: post
title: Javaé‡Œçš„SPIæœºåˆ¶
date: 2018-06-22
categories: code
tags: Java SPI JavaPoet
---

> é…åˆ JavaPoet é£Ÿç”¨æ›´ä½³

SPI å…¨ç§°ä¸º (Service Provider Interface) ï¼Œæ˜¯JDKå†…ç½®çš„ä¸€ç§æœåŠ¡æä¾›å‘ç°æœºåˆ¶ã€‚

å½“æœåŠ¡çš„æä¾›è€…ï¼Œæä¾›äº†æœåŠ¡æ¥å£çš„ä¸€ç§å®ç°ä¹‹åï¼Œåœ¨jaråŒ…çš„`META-INF/services/`ç›®å½•é‡ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªä»¥æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶é‡Œå°±æ˜¯å®ç°è¯¥æœåŠ¡æ¥å£çš„å…·ä½“å®ç°ç±»ã€‚è€Œå½“å¤–éƒ¨ç¨‹åºè£…é…è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œå°±èƒ½é€šè¿‡è¯¥jaråŒ…`META-INF/services/`é‡Œçš„é…ç½®æ–‡ä»¶æ‰¾åˆ°å…·ä½“çš„å®ç°ç±»åï¼Œå¹¶è£…è½½å®ä¾‹åŒ–ï¼Œå®Œæˆæ¨¡å—çš„æ³¨å…¥ã€‚ åŸºäºè¿™æ ·ä¸€ä¸ªçº¦å®šå°±èƒ½å¾ˆå¥½çš„æ‰¾åˆ°æœåŠ¡æ¥å£çš„å®ç°ç±»ï¼Œè€Œä¸éœ€è¦å†ä»£ç é‡Œåˆ¶å®šã€‚

JDKæä¾›æœåŠ¡å®ç°æŸ¥æ‰¾çš„ä¸€ä¸ªå·¥å…·ç±»ï¼š`java.util.ServiceLoader`ã€‚

ä¸¾ä¸ªæ —å­ğŸŒ°

å®šä¹‰ä¸€ä¸ªæ¥å£

```java
public interface IProvider {
    String getName();
}
```

å®šä¹‰å®ç°ç±»

```java
public class ProviderA implements IProvider {
    @Override
    public String getName() {
        return "I'm ProviderA";
    }
}
```

```java
public class ProviderB implements IProvider {
    @Override
    public String getName() {
        return "I'm ProviderB";
    }
}
```

åœ¨`src/main`ç›®å½•ä¸‹åˆ›å»º`resources/META-INF/services`æ–‡ä»¶å¤¹ï¼Œåœ¨`services`ä¸‹åˆ›å»ºæ–‡ä»¶åæ˜¯æ¥å£å®Œæ•´è·¯å¾„çš„æ–‡ä»¶`pers.victor.test.IProvider`ï¼Œæ–‡ä»¶å†…å†™å…¥å®ç°ç±»çš„å®Œæ•´è·¯å¾„ï¼Œå¦‚æœæœ‰å¤šä¸ªå®ç°ç±»åˆ™ä¸€è¡Œå†™ä¸€ä¸ªï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹

```js
pers.victor.test.ProviderA
pers.victor.test.ProviderB
```

åœ¨ä»£ç é‡Œè·å–å®ç°ç±»å®ä¾‹

```java
ServiceLoader<IProvider> serviceLoader = ServiceLoader.load(IProvider.class);
for (IProvider provider : serviceLoader) {
	 System.out.println(provider.getName());
}
```

æ‰“å°ç»“æœ

```js
I'm ProviderA
I'm ProviderB
```

æˆåŠŸåœ°åˆ©ç”¨æ¥å£è·å–äº†å®ç°ç±»ã€‚

å¦‚æœå·¥ç¨‹å†…æœ‰ABæ¨¡å—ä¸äº’ç›¸ä¾èµ–ä½†æ˜¯æƒ³åšä¸€äº›è°ƒç”¨ä¹‹ç±»çš„ï¼ŒSPIå¯ä»¥æä¾›ä¸€ç§æ€è·¯ã€‚

å› ä¸ºæ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„åˆ›å»ºéƒ½æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼Œæ¯”è¾ƒç¹çï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å’Œ`JavaPoet`é…åˆä½¿ç”¨ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ›å»ºæ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œçœæ—¶çœåŠ›ã€‚

