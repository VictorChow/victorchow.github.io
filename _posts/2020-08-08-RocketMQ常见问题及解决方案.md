---
layout: post
title: RocketMQ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
date: 2020-08-08
categories: code
tags: MQ RocketMQ
typora-root-url: ../../victorchow.github.io
---

> 

## â˜ é¡ºåºæ¶ˆè´¹

å› ä¸º RocketMQ çš„ä¸»é¢˜å¯ä»¥åˆ†å¸ƒåœ¨å¤šä¸ª Broker ä¸Šï¼Œæ‰€ä»¥ RocketMQ åœ¨ä¸»é¢˜å±‚é¢æ˜¯æ— åºçš„ï¼Œåªåœ¨ **é˜Ÿåˆ—å±‚é¢** æ‰ä¿è¯æœ‰åº

### é¡ºåºæ–¹å¼

>**æ™®é€šé¡ºåºï¼š**æ¶ˆè´¹è€…é€šè¿‡ **åŒä¸€ä¸ªæ¶ˆè´¹é˜Ÿåˆ—** æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯æœ‰é¡ºåºçš„ ï¼Œä¸åŒæ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯åˆ™å¯èƒ½æ˜¯æ— åºçš„
>
>**ä¸¥æ ¼é¡ºåº**ï¼šæ¶ˆè´¹è€…æ”¶åˆ°çš„ **æ‰€æœ‰æ¶ˆæ¯** å‡æ˜¯æœ‰é¡ºåºçš„ï¼Œåœ¨å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§

ä½†åœ¨å®é™…ä¸šåŠ¡ä¸­è¦æ±‚ä¸¥æ ¼é¡ºåºçš„åœºæ™¯å¹¶ä¸å¤šï¼Œå¹¶ä¸”å¦‚æœä½¿ç”¨äº†ä¸¥æ ¼é¡ºåºæ¨¡å¼ï¼Œ`Broker` é›†ç¾¤ä¸­åªè¦æœ‰ä¸€å°æœºå™¨ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªé›†ç¾¤éƒ½ä¸å¯ç”¨

å¸¸ç”¨çš„åœºæ™¯æ¯”å¦‚çŸ­ä¿¡ç³»ç»Ÿæˆ–è€…é‚®ä»¶ç³»ç»Ÿç¨å¾®æ™šå‡ ç§’å‘é€çŸ­ä¿¡æˆ–é‚®ä»¶æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ï¼Œæ‰€ä»¥å¦‚æœèƒ½å®¹å¿çŸ­æš‚çš„ä¹±åºåˆ™æ¨èä½¿ç”¨æ™®é€šé¡ºåºæ¨¡å¼

### æ™®é€šé¡ºåºä¸‹çš„å®ç°

æ™®é€šé¡ºåºåªèƒ½ä¿è¯åŒä¸€ä¸ªæ¶ˆè´¹é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯æ˜¯é¡ºåºçš„ï¼Œä½† `Producer` ç”Ÿäº§æ¶ˆæ¯çš„æ—¶å€™ä¼šæ ¹æ® **è´Ÿè½½å‡è¡¡ç­–ç•¥** è¿›è¡Œè½®è¯¢æ¥å‘åŒä¸€ä¸»é¢˜çš„ä¸åŒæ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œå‡è®¾æœ‰ä¸‰ä¸ªæ¶ˆæ¯åˆ†åˆ«æ˜¯åŒä¸€ä¸ªä¸šåŠ¡æµç¨‹çš„æ­¥éª¤ 1ã€æ­¥éª¤ 2ã€æ­¥éª¤ 3ï¼Œåœ¨è½®è¯¢çš„ç­–ç•¥ä¸‹è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¼šè¢«å‘é€åˆ° **ä¸åŒé˜Ÿåˆ—**ï¼Œä¸åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œå°±æ— æ³•é€šè¿‡é˜Ÿåˆ—æœ‰åºç‰¹æ€§æ¥ä¿è¯æ¶ˆæ¯æœ‰åºæ€§äº†

![](/assets/img/20200808-1.svg)

æ‰€æœ‰æ¶ˆæ¯æ ¹æ® Sharding Key è¿›è¡ŒåŒºå—åˆ†åŒºï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®åŒä¸€ä¸ªä¸šåŠ¡çš„ä¸šåŠ¡æµæ°´å·è¿›è¡Œ **HASHå–æ¨¡** ä½¿ Sharding Key ä¸€è‡´ï¼Œæ¥ä¿è¯åŒä¸€ä¸ªä¸šåŠ¡åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä»è€Œå®ç°é¡ºåºæ¶ˆè´¹

![](/assets/img/20200808-2.svg)

## â˜ é‡å¤æ¶ˆè´¹

å¦‚æœ `Consumer` æ¶ˆè´¹å®Œå¹¶è¿”å›ç»™æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†æˆåŠŸå›åº”çš„æ—¶å€™å‡ºç°äº†ç½‘ç»œæ³¢åŠ¨æˆ– `Broker` æ„å¤–é‡å¯ç­‰æ„å¤–æƒ…å†µï¼Œå›åº”æ²¡æœ‰å‘é€æˆåŠŸï¼Œå¯¼è‡´é˜Ÿåˆ—çš„ offset æ²¡æœ‰ +1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯å¦‚æœå†æ¬¡è¢«æ¶ˆè´¹å°±ä¼šå‡ºç°é—®é¢˜

å¯ä»¥åˆ†ä¸¤ç§æƒ…å†µè€ƒè™‘ï¼š

* ### å¯ä»¥é‡å¤æ¶ˆè´¹çš„æ¶ˆæ¯

  æ¯”å¦‚å‘çŸ­ä¿¡é€šçŸ¥è¿™ç§æ¶ˆæ¯ï¼Œå‘ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„çŸ­ä¿¡å¯¹ä¸šåŠ¡æ²¡æœ‰å¤ªå¤§çš„å½±å“ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©å¼±æ ¡éªŒæˆ–è€…ä¸æ ¡éªŒ

- ### ä¸å¯é‡å¤æ¶ˆè´¹çš„æ¶ˆæ¯

  æ¯”å¦‚ç”¨æˆ·çš„è´¦æˆ·ä½™é¢è¿™ç§ï¼Œå¿…é¡»è¦æ±‚ `Consumer` å®ç°å¼ºæ ¡éªŒ ï¼Œå¯ä»¥é€‰æ‹©ä¸æ‰§è¡Œé‡å¤çš„æ¶ˆæ¯ï¼Œæˆ–è€…å¯¹åŒä¸€ä¸ªæ¶ˆæ¯æ‰§è¡Œå¤šå°‘æ¬¡ä¹Ÿä¸ä¼šå½±å“ç»“æœ

## â˜ åˆ†å¸ƒå¼äº‹åŠ¡

äº‹åŠ¡å°±æ˜¯è¦ä¹ˆéƒ½æ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼ŒåŒä¸€ä¸ªç³»ç»Ÿä¸­å¯ä»¥æ¯”è¾ƒç®€å•çš„å®ç°äº‹åŠ¡ï¼Œåœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ä¸åŒæœåŠ¡éœ€è¦è¿›è¡Œè°ƒç”¨ï¼Œå®ç°äº‹åŠ¡å°±ä¼šæ¯”è¾ƒå›°éš¾

å¸¸è§çš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°æœ‰ **2PCï¼ˆTwo Phase Commitmentï¼‰**ã€**TCCï¼ˆTry Confirm Cancelï¼‰** å’Œ **äº‹åŠ¡æ¶ˆæ¯ï¼ˆhalf åŠæ¶ˆæ¯æœºåˆ¶ï¼‰**ï¼Œæ¯ä¸€ç§å®ç°éƒ½æœ‰å…¶ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰å„è‡ªçš„é—®é¢˜ï¼Œéƒ½ **ä¸æ˜¯å®Œç¾** çš„è§£å†³æ–¹æ¡ˆ

RocketMQ ä½¿ç”¨çš„æ˜¯ **äº‹åŠ¡æ¶ˆæ¯åŠ ä¸Šäº‹åŠ¡åæŸ¥æœºåˆ¶** æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜

![](/assets/img/20200808-3.svg)

åœ¨ç¬¬ä¸€æ­¥å‘é€çš„ half æ¶ˆæ¯ ï¼Œ**åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸å¯è§çš„**

> å¦‚æœæ¶ˆæ¯æ˜¯ half æ¶ˆæ¯ï¼Œå°†å¤‡ä»½åŸæ¶ˆæ¯çš„ä¸»é¢˜ä¸æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åæ”¹å˜ä¸»é¢˜ä¸º **RMQ_SYS_TRANS_HALF_TOPIC**ï¼Œç”±äºæ¶ˆè´¹ç»„æœªè®¢é˜…è¯¥ä¸»é¢˜ï¼Œæ‰€ä»¥æ— æ³•æ¶ˆè´¹ half ç±»å‹çš„æ¶ˆæ¯ï¼ŒRocketMQ ä¼šå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä»ä¸»é¢˜ä¸º **RMQ_SYS_TRANS_HALF_TOPIC** ä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œæ ¹æ®ç”Ÿäº§è€…ç»„è·å–ä¸€ä¸ªæœåŠ¡æä¾›è€…å‘é€å›æŸ¥äº‹åŠ¡çš„çŠ¶æ€è¯·æ±‚ï¼Œæ ¹æ®äº‹åŠ¡çŠ¶æ€æ¥å†³å®šæ˜¯æäº¤æˆ–å›æ»šæ¶ˆæ¯

å¦‚æœç¬¬ 4 æ­¥çš„æ¶ˆæ¯æ²¡æœ‰å‘é€æˆåŠŸï¼Œåˆ™ RocketMQ å¿…é¡»è¦é€šè¿‡ç¬¬ 5 æ­¥æ¥è¿›è¡Œ **äº‹åŠ¡åæŸ¥**ï¼Œå¦åˆ™ RocketMQ æ— æ³•å¾—çŸ¥æ˜¯å¦éœ€è¦ç»™æ¶ˆè´¹è€…æ¶ˆè´¹

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ MQ Server æŒ‡å‘ç³»ç»Ÿ B çš„æ“ä½œå·²ç»å’Œç³»ç»Ÿ A ä¸ç›¸å…³äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ **æœ¬åœ°äº‹åŠ¡å’Œå­˜å‚¨æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—æ‰æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œ**è¿™æ ·ä¹Ÿå°±äº§ç”Ÿäº†äº‹åŠ¡çš„**æœ€ç»ˆä¸€è‡´æ€§**ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œ**æ¯ä¸ªç³»ç»Ÿåªè¦ä¿è¯å®ƒè‡ªå·±é‚£ä¸€éƒ¨åˆ†çš„äº‹åŠ¡å°±è¡Œäº†**

## â˜ æ¶ˆæ¯å †ç§¯

æ¶ˆæ¯å †ç§¯çš„åŸå› å°±åªæœ‰ä¸¤ä¸ªï¼š**ç”Ÿäº§è€…ç”Ÿäº§å¤ªå¿«** æˆ– **æ¶ˆè´¹è€…æ¶ˆè´¹å¤ªæ…¢**

### ç”Ÿäº§è€…ç”Ÿäº§å¤ªå¿«

å¯ä»¥è€ƒè™‘ **é™æµé™çº§**ï¼Œé™ä½è¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯æ•°é‡

### æ¶ˆè´¹è€…æ¶ˆè´¹å¤ªæ…¢

å¯ä»¥è€ƒè™‘å¢åŠ å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ RocketMQ ä¸­ï¼Œ**ä¸€ä¸ªé˜Ÿåˆ—åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹**ï¼Œæ‰€ä»¥åœ¨å¢åŠ æ¶ˆè´¹è€…å®ä¾‹çš„åŒæ—¶ **è¿˜éœ€è¦å¢åŠ æ¯ä¸ªä¸»é¢˜çš„é˜Ÿåˆ—æ•°é‡**ï¼Œå¦‚æœä¸åŒæ—¶å¢åŠ é˜Ÿåˆ—å°±ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µ

![](/assets/img/20200805-3.svg)

å¢åŠ äº† `Consumer3` ä½†å› ä¸ºæ²¡æœ‰å¢åŠ é˜Ÿåˆ—å¯¼è‡´ `Consumer3` å¤„äºé—²ç½®çŠ¶æ€ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœ

### å…¶ä»–æ–¹å¼

åå°å®šæ—¶ä»»åŠ¡æ¯éš”å›ºå®šæ—¶é—´ï¼Œåˆ é™¤æ—§çš„æ²¡æœ‰ä½¿ç”¨è¿‡çš„æ¶ˆæ¯ä¿¡æ¯

æ¶ˆæ¯å®šæ—¶è½¬ç§»

## â˜ å›æº¯æ¶ˆè´¹

### æ¥è‡ªå®˜æ–¹æ–‡æ¡£çš„è§£é‡Š

å›æº¯æ¶ˆè´¹æ˜¯æŒ‡ `Consumer` å·²ç»æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯ï¼Œç”±äºä¸šåŠ¡ä¸Šéœ€æ±‚éœ€è¦é‡æ–°æ¶ˆè´¹ï¼Œåœ¨ `RocketMQ` ä¸­ï¼Œ `Broker` åœ¨å‘ `Consumer` æŠ•é€’æˆåŠŸæ¶ˆæ¯åï¼Œ**æ¶ˆæ¯ä»ç„¶éœ€è¦ä¿ç•™**ï¼Œå¹¶ä¸”é‡æ–°æ¶ˆè´¹ä¸€èˆ¬æ˜¯æŒ‰ç…§æ—¶é—´ç»´åº¦ï¼Œä¾‹å¦‚ç”±äº `Consumer` ç³»ç»Ÿæ•…éšœï¼Œæ¢å¤åéœ€è¦é‡æ–°æ¶ˆè´¹1å°æ—¶å‰çš„æ•°æ®ï¼Œé‚£ä¹ˆ `Broker` è¦æä¾›ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥æŒ‰ç…§æ—¶é—´ç»´åº¦æ¥å›é€€æ¶ˆè´¹è¿›åº¦ã€‚`RocketMQ` æ”¯æŒæŒ‰ç…§æ—¶é—´å›æº¯æ¶ˆè´¹ï¼Œæ—¶é—´ç»´åº¦ç²¾ç¡®åˆ°æ¯«ç§’

## â˜ åˆ·ç›˜æœºåˆ¶

### åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜

é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ˜¯éœ€è¦è¿›è¡Œå­˜å‚¨æŒä¹…åŒ–ï¼Œåœ¨ RocketMQ ä¸­æœ‰ **åŒæ­¥åˆ·ç›˜** å’Œ **å¼‚æ­¥åˆ·ç›˜** ä¸¤ç§æ–¹å¼

![](/assets/img/20200808-4.svg)

ä¸»è¦çš„åŒºåˆ«å°±æ˜¯åŒæ­¥åˆ·ç›˜ä¸­éœ€è¦ç­‰å¾…ä¸€ä¸ªåˆ·ç›˜æˆåŠŸçš„ `ACK`ï¼ŒåŒæ­¥åˆ·ç›˜åˆ™æ˜¯å¼€å¯çº¿ç¨‹è¿›è¡Œåˆ·ç›˜

* #### åŒæ­¥åˆ·ç›˜

  æ¶ˆæ¯å¯é æ€§é«˜ï¼Œä½† **æ€§èƒ½ä¸Šä¼šæœ‰è¾ƒå¤§å½±å“** ï¼Œä¸€èˆ¬åœ°é€‚ç”¨äºé‡‘èç­‰ç‰¹å®šä¸šåŠ¡åœºæ™¯

* #### å¼‚æ­¥åˆ·ç›˜

  **é™ä½äº†è¯»å†™å»¶è¿Ÿ** ï¼Œæé«˜äº† MQ çš„æ€§èƒ½å’Œååé‡ï¼Œ**ä½†åœ¨ `Broker` æ„å¤–å®•æœºçš„æ—¶å€™ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®**ï¼Œä¸€èˆ¬é€‚ç”¨äºå¦‚å‘éªŒè¯ç ç­‰å¯¹äºæ¶ˆæ¯ä¿è¯è¦æ±‚ä¸å¤ªé«˜çš„åœºæ™¯

### åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶

åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜æ˜¯åœ¨å•ä¸ªç»“ç‚¹å±‚é¢çš„ï¼Œè€ŒåŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶ä¸»è¦æ˜¯æŒ‡çš„ `Borker` ä¸»ä»æ¨¡å¼ä¸‹ï¼Œä¸»èŠ‚ç‚¹è¿”å›æ¶ˆæ¯ç»™å®¢æˆ·ç«¯çš„æ—¶å€™æ˜¯å¦éœ€è¦åŒæ­¥ä»èŠ‚ç‚¹

![](/assets/img/20200808-5.svg)

- åŒæ­¥å¤åˆ¶ï¼š **åªæœ‰æ¶ˆæ¯åŒæ­¥åŒå†™åˆ°ä¸»ä»ç»“ç‚¹ä¸Šæ—¶æ‰è¿”å›å†™å…¥æˆåŠŸ** 
- å¼‚æ­¥å¤åˆ¶ï¼š **æ¶ˆæ¯å†™å…¥ä¸»èŠ‚ç‚¹ä¹‹åå°±ç›´æ¥è¿”å›å†™å…¥æˆåŠŸ** 

ä¸€èˆ¬æ¥è¯´ï¼Œæ¶ˆæ¯å†™å…¥çš„èŠ‚ç‚¹è¶Šå¤šå°±æ›´èƒ½ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œä½†æ˜¯éšä¹‹çš„æ€§èƒ½ä¹Ÿä¼šä¸‹é™ï¼Œéœ€è¦æ ¹æ®ç‰¹å®šä¸šåŠ¡åœºæ™¯å»é€‰æ‹©é€‚åº”çš„æ–¹æ¡ˆ

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„åˆ·ç›˜ç­–ç•¥ä¿è¯çš„æ˜¯ **æ¶ˆæ¯å¯é æ€§**ï¼Œä¸åŒçš„å¤åˆ¶ç­–ç•¥ä»…ä»…æ˜¯å½±å“åˆ°äº† **å¯ç”¨æ€§**ï¼Œ`RocketMQ` æ˜¯ä¸æ”¯æŒè‡ªåŠ¨ä¸»ä»åˆ‡æ¢çš„ï¼Œ**å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œç”Ÿäº§è€…å°±ä¸èƒ½å†ç»™è¿™ä¸ªä¸»èŠ‚ç‚¹ç”Ÿäº§æ¶ˆæ¯äº†**

å¦‚æœé‡‡ç”¨å¼‚æ­¥å¤åˆ¶çš„æ–¹å¼ï¼Œåœ¨ä¸»èŠ‚ç‚¹è¿˜æœªå‘é€å®Œéœ€è¦åŒæ­¥çš„æ¶ˆæ¯çš„æ—¶å€™ä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™ä»èŠ‚ç‚¹å°±å°‘äº†ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚ä½†æ˜¯æ­¤æ—¶ç”Ÿäº§è€…æ— æ³•å†ç»™ä¸»èŠ‚ç‚¹ç”Ÿäº§æ¶ˆæ¯äº†ï¼Œ**æ¶ˆè´¹è€…å¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹è¿›è¡Œæ¶ˆè´¹**ï¼ˆä»…ä»…æ˜¯æ¶ˆè´¹ï¼‰ï¼Œæ‰€ä»¥åœ¨ä¸»èŠ‚ç‚¹æŒ‚æ‰çš„æ—¶é—´åªä¼šäº§ç”Ÿä¸»ä»ç»“ç‚¹çŸ­æš‚çš„æ¶ˆæ¯ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé™ä½äº†å¯ç”¨æ€§ï¼Œè€Œå½“ä¸»èŠ‚ç‚¹é‡å¯ä¹‹åï¼Œä»èŠ‚ç‚¹é‚£éƒ¨åˆ†æœªæ¥å¾—åŠå¤åˆ¶çš„æ¶ˆæ¯è¿˜ä¼šç»§ç»­å¤åˆ¶

åœ¨å•ä¸»ä»æ¶æ„ä¸­ï¼Œå¦‚æœä¸€ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æ•´ä¸ªç³»ç»Ÿä¸èƒ½å†ç”Ÿäº§äº†ï¼›å¤šä¸»ä»æ¶æ„ä¸­æ¯ä¸ª `Topic` æ˜¯åˆ†å¸ƒåœ¨ä¸åŒ `Broker` ä¸­çš„ï¼Œæé«˜äº†å¯ç”¨æ€§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

![](/assets/img/20200805-5.svg)

ä½†æ˜¯è¿™ç§å¤åˆ¶æ–¹å¼æ— æ³•ä¿è¯ **ä¸¥æ ¼é¡ºåº**ã€‚ä¹‹å‰æåˆ°äº†å¦‚ä½•ä¿è¯çš„æ¶ˆæ¯é¡ºåºæ€§æ˜¯é€šè¿‡å°†ä¸€ä¸ªè¯­ä¹‰çš„æ¶ˆæ¯å‘é€åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä½¿ç”¨ `Topic` ä¸‹çš„é˜Ÿåˆ—æ¥ä¿è¯é¡ºåºæ€§çš„ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬ä¸»èŠ‚ç‚¹ A è´Ÿè´£çš„æ˜¯è®¢å• A çš„ä¸€ç³»åˆ—è¯­ä¹‰æ¶ˆæ¯ï¼Œç„¶åå®ƒæŒ‚äº†ï¼Œè¿™æ ·å…¶ä»–èŠ‚ç‚¹æ˜¯æ— æ³•ä»£æ›¿ä¸»èŠ‚ç‚¹ A çš„ï¼Œå¦‚æœæˆ‘ä»¬ä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥å­˜å…¥ä»»ä½•æ¶ˆæ¯ï¼Œé‚£å°±æ²¡æœ‰é¡ºåºæ€§å¯è¨€äº†

è€Œåœ¨ `RocketMQ` ä¸­é‡‡ç”¨äº† `Dledger` è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦æ±‚åœ¨å†™å…¥æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦æ±‚**è‡³å°‘æ¶ˆæ¯å¤åˆ¶åˆ°åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹ä¹‹å**ï¼Œæ‰ç»™å®¢â¼¾ç«¯è¿”å›å†™â¼ŠæˆåŠŸï¼Œå¹¶ä¸”å®ƒæ˜¯â½€æŒé€šè¿‡é€‰ä¸¾æ¥åŠ¨æ€åˆ‡æ¢ä¸»èŠ‚ç‚¹çš„

> ä¹Ÿä¸æ˜¯è¯´ `Dledger` æ˜¯ä¸ªå®Œç¾çš„æ–¹æ¡ˆï¼Œè‡³å°‘åœ¨ `Dledger` é€‰ä¸¾è¿‡ç¨‹ä¸­æ˜¯æ— æ³•æä¾›æœåŠ¡çš„ï¼Œè€Œä¸”ä»–å¿…é¡»è¦ä½¿ç”¨ä¸‰ä¸ªèŠ‚ç‚¹æˆ–ä»¥ä¸Šï¼Œå¦‚æœå¤šæ•°èŠ‚ç‚¹åŒæ—¶æŒ‚æ‰ä»–ä¹Ÿæ˜¯æ— æ³•ä¿è¯å¯ç”¨æ€§çš„ï¼Œè€Œä¸”è¦æ±‚æ¶ˆæ¯å¤åˆ¶åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ•ˆç‡å’Œç›´æ¥å¼‚æ­¥å¤åˆ¶è¿˜æ˜¯æœ‰ä¸€å®šçš„å·®è·çš„

## â˜ æ¶ˆæ¯ä¸¢å¤±

æ¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼ŒåŒæ­¥è½ç›˜åæ‰è¿”å›ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æˆåŠŸï¼Œè¿™æ ·åªè¦ç”Ÿäº§è€…å¾—åˆ°äº†æ¶ˆæ¯å‘é€ç”Ÿæˆçš„è¿”å›ï¼Œé™¤äº†ç¡¬ç›˜æŸåçš„æƒ…å†µï¼Œéƒ½å¯ä»¥ä¿è¯ä¸ä¼šæ¶ˆæ¯ä¸¢å¤±

## ğŸ’  é¸£è°¢

[Apache RocketMQ](https://rocketmq.apache.org/) ğŸ‘

[æ¶ˆæ¯é˜Ÿåˆ—æ‰«ç›²](https://github.com/Snailclimb/JavaGuide/blob/master/docs/system-design/data-communication/RocketMQ.md) ğŸ‘

[RocketMQ-Questions](https://github.com/Snailclimb/JavaGuide/blob/master/docs/system-design/data-communication/RocketMQ-Questions.md) ğŸ‘